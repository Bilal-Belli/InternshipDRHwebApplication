<!doctype html>
<html>
<head>
    <title>DRH - Condidats</title>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.1.3/dist/css/bootstrap.min.css" integrity="sha384-MCw98/SFnGE8fJT3GXwEOngsV7Zt27NXFoaoApmYm81iuXoPkFOJwJ8ERdknLPMO" crossorigin="anonymous">
    <script src="https://code.jquery.com/jquery-1.11.1.min.js"></script>
</head>
<body>
    <nav class="navbar bg-secondary">
        <a class="navbar-brand text-light" href="accueil">Accueil</a>
        <button class="btn btn-outline-light my-2 my-sm-0"><a class="text-light" href="/">Déconnecter</a></button>
    </nav>
    <div class="container">
        <div class="py-3"></div>
        <div class="row">
            <table id="example" class="table table-striped table-bordered table-responsive table-hover" style="width:100%">
                <thead>
                    <tr>
                        <th><input type="checkbox" onclick="checkAll(this)"></th>
                        <th>ID</th>
                        <th>Nom</th>
                        <th>Prénom</th>
                        <th>E-mail</th>
                        <th>Spécialité</th>
                        <th>Diplomes</th>
                        <th>Etablissement</th>
                        <th>Adress</th>
                        <th>Wilaya</th>
                        <th>N° Tél</th>
                        <th>CV</th>
                        <th>Remarques</th>
                        <th>Equipe</th>
                        <th>Diplomes</th>
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <% data.forEach(entry => { %>
                            <td><input type="checkbox" name=""></td>
                            <td>numero</td>
                            <td><%= entry.nomCondidat %></td>
                            <td><%= entry.prenomCondidat %></td>
                            <td><%= entry.emailCondidat %></td>
                            <td><%= entry.specialite %></td>
                            <td><%= entry.degree %></td>
                            <td><%= entry.etablissement %></td>
                            <td><%= entry.adressComplet %></td>
                            <td><%= entry.wilaya %></td>
                            <td><%= entry.numeroTel %></td>
                            <td><a href="<%= entry.pathCV %>">CV</a></td>
                            <td><%= entry.remarques %></td>
                            <td><%= entry.IDequipe %></td>
                            <td id="<%= entry.IDcondidat %>"></td>
                    </tr>
                    <% }) %>
                </tbody>
            </table>
        </div>
    </div>
    <div class="py-3"></div>
    <div class="py-3"></div>
</body>
<footer class="fixed-bottom">
    <div class="bg-secondary">
        <div class="footer-copyright text-center py-2 text-light">
            © <script>document.write(new Date().getFullYear())</script> Copyright | Direction des resources Humaine - DRH
        </div>
    </div>
</footer>
<script id="Diplomesdata" type="application/json">
[
    <% data2.forEach(entry => { %>
    {"IDdiplome":"<%= entry.IDdiplome %>",
    "IDcondidat":"<%= entry.IDcondidat %>",
    "pathDiplome":"<%= entry.pathDiplome %>"},
<% }) %>
{}]
</script>
<script>
// function used to unicode some special caracters when fetch from database
function decodeHTMLEntities(text) {
    var entities = [['amp', '&'],['apos', '\''],['#x27', '\''],['#x2F', '/'],['#39', '\''],['#47', '/'],['lt', '<'],['gt', '>'],['nbsp', ' '],['quot', '"']];
    for (var i = 0, max = entities.length; i < max; ++i) {
        text = text.replace(new RegExp('&'+entities[i][0]+';', 'g'), entities[i][1]);
    }
    return text;
};

// this render the links to diplomas of a condidate
let Diplomesdata = JSON.parse(document.getElementById('Diplomesdata').innerHTML);
for (m=0; m< Diplomesdata.length; m++){
    document.getElementById(Diplomesdata[m].IDcondidat).innerHTML += "<a href=\""+decodeHTMLEntities(Diplomesdata[m].pathDiplome)+"\">Dip </a>";
};
</script>
<script>
$(document).ready(function() {
    $('#example').DataTable({     
    "aLengthMenu": [[5, 10, 25, -1], [5, 10, 25, "All"]],
    "iDisplayLength": 5});
});
function checkAll(bx) {
    var cbs = document.getElementsByTagName('input');
    for(var i=0; i < cbs.length; i++) {
        if(cbs[i].type == 'checkbox') {
        cbs[i].checked = bx.checked;
        }
    }
}
</script>
<script src="https://cdn.datatables.net/1.10.16/js/jquery.dataTables.min.js"></script>
<script src="https://cdn.datatables.net/1.10.16/js/dataTables.bootstrap4.min.js"></script>
</html>