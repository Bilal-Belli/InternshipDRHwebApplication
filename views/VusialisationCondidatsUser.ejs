<!doctype html>
<html>
<head>
    <title>DRH - Condidats</title>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.1.3/dist/css/bootstrap.min.css" integrity="sha384-MCw98/SFnGE8fJT3GXwEOngsV7Zt27NXFoaoApmYm81iuXoPkFOJwJ8ERdknLPMO" crossorigin="anonymous">
    <script src="https://code.jquery.com/jquery-1.11.1.min.js"></script>
</head>
<body>
    <nav class="navbar bg-secondary">
        <a class="navbar-brand text-light" href="accueil">Accueil</a>
        <button class="btn btn-outline-light my-2 my-sm-0"><a class="text-light" href="/">Déconnecter</a></button>
    </nav>
    <div class="container">
        <div class="py-3"></div>
        <div class="row">
            <table class="table table-hover table-responsive table-striped" id=tableID>
                <thead>
                    <tr>
                        <th scope="col">ID</th>
                        <th scope="col">Nom</th>
                        <th scope="col">Prénom</th>
                        <th scope="col">E-mail</th>
                        <th scope="col">Spécialité</th>
                        <th scope="col">Diplomes</th>
                        <th scope="col">Etablissement</th>
                        <th scope="col">Adress</th>
                        <th scope="col">Wilaya</th>
                        <th scope="col">N° Tél</th>
                        <th scope="col">CV</th>
                        <th scope="col">Remarques</th>
                        <th scope="col">Equipe</th>
                        <th scope="col">Diplomes</th>
                    </tr>
                    </thead>
                    <tbody>
                    <tr>
                        <% data.forEach(entry => { %>
                        <th scope="row"><%= entry.IDcondidat %></th>
                        <td><%= entry.nomCondidat %></td>
                        <td><%= entry.prenomCondidat %></td>
                        <td><%= entry.emailCondidat %></td>
                        <td><%= entry.specialite %></td>
                        <td><%= entry.degree %></td>
                        <td><%= entry.etablissement %></td>
                        <td><%= entry.adressComplet %></td>
                        <td><%= entry.wilaya %></td>
                        <td><%= entry.numeroTel %></td>
                        <td><a href="<%= entry.pathCV %>">CV</a></td>
                        <td><%= entry.remarques %></td>
                        <td><%= entry.IDequipe %></td>
                        <td id="<%= entry.IDcondidat %>"></td>
                    </tr>
                    <% }) %>
                </tbody>
            </table>
        </div>
        <div class="py-3"></div>
        <div class="py-3"></div>
    </div>
</body>
<footer class="fixed-bottom">
    <div class="bg-secondary">
        <div class="footer-copyright text-center py-2 text-light">
            © <script>document.write(new Date().getFullYear())</script> Copyright | Direction des resources Humaine - DRH
        </div>
    </div>
</footer>
<script id="Diplomesdata" type="application/json">
[
    <% data2.forEach(entry => { %>
    {"IDdiplome":"<%= entry.IDdiplome %>",
    "IDcondidat":"<%= entry.IDcondidat %>",
    "pathDiplome":"<%= entry.pathDiplome %>"},
<% }) %>
{}]
</script>
<script>
// function used to unicode some special caracters when fetch from database
function decodeHTMLEntities(text) {
    var entities = [['amp', '&'],['apos', '\''],['#x27', '\''],['#x2F', '/'],['#39', '\''],['#47', '/'],['lt', '<'],['gt', '>'],['nbsp', ' '],['quot', '"']];
    for (var i = 0, max = entities.length; i < max; ++i) {
        text = text.replace(new RegExp('&'+entities[i][0]+';', 'g'), entities[i][1]);
    }
    return text;
};

// this render the links to diplomas of a condidate
let Diplomesdata = JSON.parse(document.getElementById('Diplomesdata').innerHTML);
for (m=0; m< Diplomesdata.length; m++){
    document.getElementById(Diplomesdata[m].IDcondidat).innerHTML += "<a href=\""+decodeHTMLEntities(Diplomesdata[m].pathDiplome)+"\">Dip </a>";
};
</script>
<script>
$(document).ready(function() {
  $('#tableID').DataTable();
});
// i need to install bootstrap 4 tables api
</script>
<script src="https://code.jquery.com/jquery-3.3.1.slim.min.js" integrity="sha384-q8i/X+965DzO0rT7abK41JStQIAqVgRVzpbzo5smXKp4YfRvH+8abtTE1Pi6jizo" crossorigin="anonymous"></script>
<script src="https://cdn.jsdelivr.net/npm/popper.js@1.14.3/dist/umd/popper.min.js" integrity="sha384-ZMP7rVo3mIykV+2+9J3UJ46jBk0WLaUAdn689aCwoqbBJiSnjAK/l8WvCWPIPm49" crossorigin="anonymous"></script>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@4.1.3/dist/js/bootstrap.min.js" integrity="sha384-ChfqqxuZUCnJSK3+MXmPNIyE6ZbWh2IMqE241rYiqJxyMiZ6OW/JmZQ5stwEULTy" crossorigin="anonymous"></script>    
</html>