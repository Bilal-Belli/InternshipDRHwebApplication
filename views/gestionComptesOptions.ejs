<!doctype html>
<html>
<head>
    <title>Admin - Comptes</title>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.1.3/dist/css/bootstrap.min.css" integrity="sha384-MCw98/SFnGE8fJT3GXwEOngsV7Zt27NXFoaoApmYm81iuXoPkFOJwJ8ERdknLPMO" crossorigin="anonymous">
    <script src="https://code.jquery.com/jquery-1.11.1.min.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.2.0/css/all.min.css" integrity="sha512-xh6O/CkQoPOWDdYTDqeRdPCVd1SpvCA9XXcUnZS2FmJNp1coAFzvtCN9BmamE+4aHK8yyUHUSCcJHgXloTyT2A==" crossorigin="anonymous" referrerpolicy="no-referrer" />
</head>
<body>
    <nav class="navbar navbar-light bg-success">
        <a class="navbar-brand text-light" href="adminaccueil">Accueil</a>
        <button class="btn btn-outline-light my-2 my-sm-0"><a class="text-light" href="/">Déconnecter</a></button>
    </nav>
    <div class="container">
        <div class="py-3"></div>
        <div class="row">
            <div class="col d-flex justify-content-center">
                <button type="button" class="btn btn-success mb-3" style="max-width: 25rem; width: 25rem;" data-toggle="modal" data-target="#exampleModalCenter">
                    Creer un compte
                </button>
            </div>
            <div class="col d-flex justify-content-center">
                <a title="Remarquer" data-toggle="popover" data-trigger="hover" data-content="Vous ne pouvez modifier qu'un seul compte à la fois.">
                    <button type="button" id="btnedit" class="btn btn-success mb-3" style="max-width: 25rem; width: 25rem;" data-toggle="modal" data-target="#exampleModalCenterM" onclick="getSelectesAccountsForEdit();fetchRowToEditForm();" disabled>
                        Modifier le compte séléctionnée
                    </button>
                </a>
            </div>
        </div>
        <div class="py-3"></div>
        <div class="row" style="overflow-x:auto;">
            <table id="tableID" class="table table-striped table-bordered table-hover" style="width: 100%;">
                <thead>
                    <tr>
                        <th><input type="checkbox" onclick="checkAll(this)" name="firstcheckbox"></th>
                        <th>Type de Post</th>
                        <th>Nom</th>
                        <th>Prénom</th>
                        <th>N° Téléphone</th>
                        <th>E-mail</th>
                        <th>Date de Création</th>
                        <th>Mot de Passe</th>
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <% data.forEach(entry => { %>
                        <td><input type="checkbox" name="<%= entry.Matricule %>" onclick="checkCHKBOX();checkCHKBOXedit();"></td>
                        <td><%= entry.typePost %></td>
                        <td><%= entry.nom %></td>
                        <td><%= entry.prenom %></td>
                        <td><%= entry.numeroTelephone %></td>
                        <td><%= entry.email %></td>
                        <td><%= entry.dateCreation %></td>
                        <td><%= entry.motPasse %></td>
                    </tr>
                    <% }) %>
                </tbody>
            </table>
        </div>
        <div class="py-3"></div>
        <div class="row">
            <div class="col d-flex justify-content-center">
                <button type="button" id="btnsup" class="btn btn-danger mb-3" style="max-width: 25rem; width: 25rem;" data-toggle="modal" data-target="#valsupp_popup" onclick="getSelectesAccounts();" disabled>
                    Supprimer les comptes séléctionnées
                </button>
            </div>
        </div>
        <div class="py-3"></div>
        <div class="py-3"></div>
    </div>
    <!-- Form 1: creer comp -->
    <div class="modal fade" id="exampleModalCenter" tabindex="-1" role="dialog" aria-labelledby="exampleModalCenterTitle" aria-hidden="true">
        <div class="modal-dialog modal-dialog-centered" role="document">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="exampleModalLongTitle">Nouveau Compte</h5>
                    <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                        <span aria-hidden="true">&times;</span>
                    </button>
                </div>
                <div class="modal-body">
                    <form id="myFormulaire" action="/compteReg" method="POST">
                        <!--  champ post du travail -->
                        <div class="form-group">
                            <select class="custom-select my-1 mr-sm-2" id="postDeTravail" name="postDeTravail" onchange="fetchAUTO();" required>
                                <option disabled selected value> Type du Post </option>
                                <option value="Directeur">Directeur</option>
                                <option value="Sous Directeur">Sous Directeur</option>
                                <option value="Chef de Département">Chef de Département</option>
                                <option value="Chef d'equipe">Chef d'equipe</option>
                                <option value="Admin">Admin</option>
                            </select>
                        </div>
                        <!-- a remplir dynamiquement -->
                        <div id="divPost">
                            <div class="form-group d-flex">
                                <label class="col-sm-5 col-form-label" id="labelPost"></label>
                                <select class="custom-select my-1 mr-sm-2" id="selPost" name="selPost" required>
                                    <option disabled selected value></option>
                                </select>
                            </div>
                        </div>
                        <input type="hidden" id="dateCreationhidden" name="dateCreationhidden" value="">
                        <!--  Nom -->
                        <div class="form-group">
                            <input type="text" class="form-control rounded-left" placeholder="Nom" id="nom" name="nom" required>
                        </div>
                        <div class="form-group d-flex" id = "ErreurMsg_nom" style="color:red; font-size: 11.5px;"></div>
                        <!-- Prenom -->
                        <div class="form-group">
                            <input type="text" class="form-control rounded-left" placeholder="Prénom" id="prenom" name="prenom" required>
                        </div>
                        <div class="form-group d-flex" id = "ErreurMsg_prenom" style="color:red; font-size: 11.5px;"></div>
                        <!-- Numero du telephone -->
                        <div class="form-group">
                            <input type="text" class="form-control rounded-left" placeholder="N° Téléphone" id="numTel" name="numTel" required>
                        </div>
                        <div class="form-group d-flex" id = "ErreurMsg_numTel" style="color:red; font-size: 11.5px;"></div>
                        <!-- Email -->
                        <div class="form-group">
                            <input type="email" class="form-control rounded-left" pattern="[a-z0-9._%+-]+@[a-z0-9.-]+\.[a-z]{2,3}$" placeholder="E-mail" required id="email" name="email">
                        </div>
                        <div class="form-group d-flex" id = "ErreurMsg_email" style="color:red; font-size: 11.5px;"></div>
                        <!-- Mot de Passe -->
                        <div class="form-group d-flex">
                            <input type="password" class="form-control rounded-left" placeholder="Mot de passe" id="MotPasse1" required name="MotPasse1">
                            <a  id="icon-click1">
                                <i class="fa fa-eye-slash"  id="icon1" style="padding: 15px"></i>
                            </a> 
                        </div>
                        <div class="form-group d-flex" id = "ErreurMsg_password_1" style="color:red; font-size: 11.5px;"></div>
                        <!-- Confirmation Mot de Passe -->  
                        <div class="form-group d-flex">
                            <input type="password" class="form-control rounded-left" placeholder="Confirmer Mot de passe" required id="MotPasse2">
                            <a  id="icon-click2">
                                <i class="fa fa-eye-slash" id="icon2" style="padding: 15px"></i>
                            </a>
                        </div>
                        <div class="form-group d-flex" id = "ErreurMsg_password_2" style="color:red; font-size: 11.5px;"></div>
                        <div class="form-group"></div>
                        <button type="submit" id="submitBtn" class="form-control btn btn-success rounded submit px-3">Inscrivez</button>
                    </form>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-dismiss="modal">Annuler</button>
                </div>
            </div>
        </div>
    </div>
    <!-- Form 2: valider la supprission -->
    <div class="modal fade" id="valsupp_popup" tabindex="-1" role="dialog" aria-labelledby="exampleModalCenterTitle" aria-hidden="true">
        <div class="modal-dialog modal-dialog-centered" role="document">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">Veuillez Confirmer la supprission</h5>
                    <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                        <span aria-hidden="true">&times;</span>
                    </button>
                </div>
                <div class="modal-body">
                    <form action="supprimerCompte" method="POST">
                        <h6 class="text-danger">Cette action n'est pas récéproque</h6>
                        <input type="hidden" id="hiddenQR" name="hiddenQR" value="">
                        <button type="submit" class="form-control btn btn-danger rounded submit px-3">Supprimer</button>
                    </form>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-dismiss="modal">Annuler</button>
                </div>
            </div>
        </div>
    </div>
    <!-- Form 3: modifier comp -->
    <div class="modal fade" id="exampleModalCenterM" tabindex="-1" role="dialog" aria-labelledby="exampleModalCenterTitle" aria-hidden="true">
        <div class="modal-dialog modal-dialog-centered" role="document">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="exampleModalLongTitleM">Modifier Informations Compte</h5>
                    <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                        <span aria-hidden="true">&times;</span>
                    </button>
                </div>
                <div class="modal-body">
                    <form id="myFormulaireM" action="/editCompte" method="POST">
                        <!-- Modifier Nom -->
                        <div class="form-group">
                            <input type="text" class="form-control rounded-left" placeholder="Nom" id="nomM" name="nomM" required>
                        </div>
                        <div class="form-group d-flex" id = "ErreurMsg_nomM" style="color:red; font-size: 11.5px;"></div>
                        <!-- Modifier Prenom -->
                        <div class="form-group">
                            <input type="text" class="form-control rounded-left" placeholder="Prénom" id="prenomM" name="prenomM" required>
                        </div>
                        <div class="form-group d-flex" id = "ErreurMsg_prenomM" style="color:red; font-size: 11.5px;"></div>
                        <!-- Modifier Numero du telephone -->
                        <div class="form-group">
                            <input type="text" class="form-control rounded-left" placeholder="N° Téléphone" id="numTelM" name="numTelM" required>
                        </div>
                        <div class="form-group d-flex" id = "ErreurMsg_numTelM" style="color:red; font-size: 11.5px;"></div>
                        <!-- Modifier Email -->
                        <div class="form-group">
                            <input type="email" class="form-control rounded-left" pattern="[a-z0-9._%+-]+@[a-z0-9.-]+\.[a-z]{2,3}$" placeholder="E-mail" required id="emailM" name="emailM">
                        </div>
                        <div class="form-group d-flex" id = "ErreurMsg_email" style="color:red; font-size: 11.5px;"></div>
                        <!-- Modifier Mot de Passe -->
                        <div class="form-group d-flex">
                            <input type="password" class="form-control rounded-left" placeholder="Mot de passe" id="MotPasse1M" required name="MotPasse1M">
                            <a  id="icon-click1M">
                                <i class="fa fa-eye-slash"  id="icon1M" style="padding: 15px"></i>
                            </a> 
                        </div>
                        <div class="form-group d-flex" id = "ErreurMsg_password_1M" style="color:red; font-size: 11.5px;"></div>
                        <!-- Confirmation Nouveau Mot de Passe -->  
                        <div class="form-group d-flex">
                            <input type="password" class="form-control rounded-left" placeholder="Confirmer Mot de passe" required id="MotPasse2M">
                            <a  id="icon-click2M">
                                <i class="fa fa-eye-slash" id="icon2M" style="padding: 15px"></i>
                            </a>
                        </div>
                        <input type="hidden" id="hiddenQRM" name="hiddenQRM" value="">
                        <div class="form-group d-flex" id = "ErreurMsg_password_2M" style="color:red; font-size: 11.5px;"></div>
                        <div class="form-group"></div>
                        <button type="submit" id="submitBtnM" class="form-control btn btn-success rounded submit px-3">Enregistrer</button>
                    </form>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-dismiss="modal">Annuler</button>
                </div>
            </div>
        </div>
    </div>
</body>
<footer class="fixed-bottom">
    <div class="bg-success">
        <div class="footer-copyright text-center py-2 text-light">
            © <script>document.write(new Date().getFullYear())</script> Copyright | Direction des resources Humaine - DRH
        </div>
    </div>
</footer>
<script>
// function used to unicode some special caracters when fetch from database
function decodeHTMLEntities(text) {
    var entities = [['amp', '&'],['apos', '\''],['#x27', '\''],['#x2F', '/'],['#39', '\''],['#47', '/'],['lt', '<'],['gt', '>'],['nbsp', ' '],['quot', '"']];
    for (var i = 0, max = entities.length; i < max; ++i) {
        text = text.replace(new RegExp('&'+entities[i][0]+';', 'g'), entities[i][1]);
    }
    return text;
};

// function that display available directions or sous directions or departements or teams
function fetchAUTO(){
    document.getElementById('selPost').required = true;
    let text = document.getElementById("postDeTravail").options[document.getElementById("postDeTravail").selectedIndex].text;
    let dirsdata = JSON.parse(document.getElementById('dirsdata').innerHTML);
    let depsdata = JSON.parse(document.getElementById('depsdata').innerHTML);
    if(text == "Directeur"){
        document.getElementById('labelPost').innerHTML = "Direction";
        document.getElementById('selPost').innerHTML = "";
        for(i=0;i<dirsdata.length;i++){
                document.getElementById('selPost').innerHTML += "<option value=\""+decodeHTMLEntities(dirsdata[i].nomDirection)+"\">"+decodeHTMLEntities(dirsdata[i].nomDirection)+"</option>";
        }
    } else{
        if(text == "Sous Directeur"){
            document.getElementById('labelPost').innerHTML = "Sous Direction";
            document.getElementById('selPost').innerHTML = "";
            for(i=0;i<dirsdata.length;i++){
                document.getElementById('selPost').innerHTML += "<option value=\""+decodeHTMLEntities(dirsdata[i].nomSousDirection)+"\">"+decodeHTMLEntities(dirsdata[i].nomSousDirection)+"</option>";
            }
        } else{
            if(text == "Chef de Département"){
                document.getElementById('labelPost').innerHTML = "Département";
                document.getElementById('selPost').innerHTML = "";
                for(i=0;i<depsdata.length;i++){
                document.getElementById('selPost').innerHTML += "<option value=\""+decodeHTMLEntities(depsdata[i].nomDepartement)+"\">"+decodeHTMLEntities(depsdata[i].nomDepartement)+"</option>";
                }
            } else{
                if(text == "Chef d'equipe"){
                    document.getElementById('labelPost').innerHTML = "Equipe";
                    document.getElementById('selPost').innerHTML = "";
                    for(i=0;i<depsdata.length;i++){
                        document.getElementById('selPost').innerHTML += "<option value=\""+decodeHTMLEntities(depsdata[i].nomEquipe)+"\">"+decodeHTMLEntities(depsdata[i].nomEquipe)+"</option>";
                    }
            } else{
                if(text == "Admin"){
                    document.getElementById('selPost').required = false;
                    document.getElementById('labelPost').innerHTML = "Administrateur";
                    document.getElementById('selPost').innerHTML = "";
                }
            }
            }
        }
    }
};
</script>
<script>
    // these two boolean tables are to validate that all conditions are verefied:
    // when entring data on create
    let validSubmit = new Array(6).fill(false);
    // when entring data on edit
    let validSubmitM = new Array(6).fill(true);

    // jquery function that hide and show password (controle the eye)
    $(document).ready(function() {
        $("#icon-click1").click(function() {
        var className = $("#icon1").attr('class');
        className = className.indexOf('slash') !== -1 ? 'fa fa-eye' : 'fa fa-eye-slash'
        $("#icon1").attr('class', className);
        var input = $("#MotPasse1");
        if (input.attr("type") == "text") {
        input.attr("type", "password");
        } else {
        input.attr("type", "text");
        }
    });
    $("#icon-click2").click(function() {
        var className = $("#icon2").attr('class');
        className = className.indexOf('slash') !== -1 ? 'fa fa-eye' : 'fa fa-eye-slash'
        $("#icon2").attr('class', className);
        var input = $("#MotPasse2");
        if (input.attr("type") == "text") {
        input.attr("type", "password");
        } else {
        input.attr("type", "text");
        }
    });
    $("#icon-click1M").click(function() {
        var className = $("#icon1M").attr('class');
        className = className.indexOf('slash') !== -1 ? 'fa fa-eye' : 'fa fa-eye-slash'
        $("#icon1M").attr('class', className);
        var input = $("#MotPasse1M");
        if (input.attr("type") == "text") {
        input.attr("type", "password");
        } else {
        input.attr("type", "text");
        }
    });
    $("#icon-click2M").click(function() {
        var className = $("#icon2M").attr('class');
        className = className.indexOf('slash') !== -1 ? 'fa fa-eye' : 'fa fa-eye-slash'
        $("#icon2M").attr('class', className);
        var input = $("#MotPasse2M");
        if (input.attr("type") == "text") {
        input.attr("type", "password");
        } else {
        input.attr("type", "text");
        }
    });
    });
    $(document).ready(function() {
        // jquery functions to controle entering data when create a new account
        $('#nom').on('input', function() {
            var input = $(this);
            var re = /^[A-Za-z]+$/;
            var is_name = input.val();
            if (is_name == "") { 
                document.getElementById("ErreurMsg_nom").innerHTML = "Vous devez remplis ce champ";
                input.removeClass("valid").addClass("invalid");
                validSubmit[0]=false;
            } else {
                if (!isNaN(is_name) || !re.test(is_name)) { 
                    document.getElementById("ErreurMsg_nom").innerHTML = "Le nom doit ne contient que des caracteres";
                    input.removeClass("valid").addClass("invalid");
                    validSubmit[0]=false;
                } else {
                    input.removeClass("invalid").addClass("valid");
                    validSubmit[0]=true;
                    document.getElementById("ErreurMsg_nom").innerHTML = "";
                }
            }
            if (validSubmit[0] == false || validSubmit[1] == false || validSubmit[2] == false || validSubmit[3] == false || validSubmit[4] == false || validSubmit[5] == false){
                document.getElementById("submitBtn").disabled = true;
            } else {
                document.getElementById("submitBtn").disabled = false;
            }
        });
        $('#prenom').on('input', function() {
            var input = $(this);
            var re = /^[A-Za-z]+$/;
            var is_prenom = input.val();
            if (is_prenom == "") {
                document.getElementById("ErreurMsg_prenom").innerHTML = "Le nom ne doit contient que des caracteres";
                input.removeClass("valid").addClass("invalid");
                validSubmit[1]=false;
            } else {
                if (!isNaN(is_prenom) || !re.test(is_prenom)) {
                    document.getElementById("ErreurMsg_prenom").innerHTML = "Le prenom ne doit contient que des caracteres";
                    input.removeClass("valid").addClass("invalid");
                    validSubmit[1]=false;
                } else {
                    input.removeClass("invalid").addClass("valid");
                    validSubmit[1]=true;
                    document.getElementById("ErreurMsg_prenom").innerHTML = "";
                }
            }
            if (validSubmit[0] == false || validSubmit[1] == false || validSubmit[2] == false || validSubmit[3] == false || validSubmit[4] == false || validSubmit[5] == false){
                document.getElementById("submitBtn").disabled = true;
            } else {
                document.getElementById("submitBtn").disabled = false;
            }
        });
        $('#numTel').on('input', function() {
            var input = $(this);
            var is_numTel = input.val();
            var pattern = /^\d+\.?\d*$/;
            if (is_numTel == "") { 
                document.getElementById("ErreurMsg_numTel").innerHTML = "Vous devez remplis ce champ";
                input.removeClass("valid").addClass("invalid");
                validSubmit[5]=false;
            } else {
                if (!(pattern.test(is_numTel))) { 
                    document.getElementById("ErreurMsg_numTel").innerHTML = "Le nom doit ne contient que des caracteres";
                    input.removeClass("valid").addClass("invalid");
                    validSubmit[5]=false;
                } else {
                    input.removeClass("invalid").addClass("valid");
                    validSubmit[5]=true;
                    document.getElementById("ErreurMsg_numTel").innerHTML = "";
                }
            }
            if (validSubmit[0] == false || validSubmit[1] == false || validSubmit[2] == false || validSubmit[3] == false || validSubmit[4] == false || validSubmit[5] == false){
                document.getElementById("submitBtn").disabled = true;
            } else {
                document.getElementById("submitBtn").disabled = false;
            }
        });
        $('#email').on('input', function() {
            var input = $(this);
            var re = /^[a-zA-Z0-9.!#$%&'*+/=?^_`{|}~-]*$/;
            var is_email = input.val();
            if (is_email == "") {
                document.getElementById("ErreurMsg_email").innerHTML = "Vous devez remplis ce champ";
                input.removeClass("valid").addClass("invalid");
                validSubmit[2]=false;
            } else {
                if (re.test(is_email)) {
                    document.getElementById("ErreurMsg_email").innerHTML = "Vous devez respecter le format d'un Email";
                    input.removeClass("valid").addClass("invalid");
                    validSubmit[2]=false;
                } else {
                    input.removeClass("invalid").addClass("valid");
                    validSubmit[2]=true;
                    document.getElementById("ErreurMsg_email").innerHTML = "";
                }
            }
            if (validSubmit[0] == false || validSubmit[1] == false || validSubmit[2] == false || validSubmit[3] == false || validSubmit[4] == false || validSubmit[5] == false){
                document.getElementById("submitBtn").disabled = true;
            } else {
                document.getElementById("submitBtn").disabled = false;
            }
        });
        $('#MotPasse1').on('input', function() {
            var input = $(this);
            var is_password = input.val();
            if (is_password == "") {
                document.getElementById("ErreurMsg_password_1").innerHTML = "Veuillez entrer un mot de passe";
                input.removeClass("valid").addClass("invalid");
                validSubmit[3]=false;
            } else {
                if (is_password.length < 8) {
                    document.getElementById("ErreurMsg_password_1").innerHTML = "Le mot de passe doit etre plus de 8 caractères";
                    input.removeClass("valid").addClass("invalid");
                    validSubmit[3]=false;
                } else {
                    if (is_password.length > 24) {
                        document.getElementById("ErreurMsg_password_1").innerHTML = "Le mot de passe ne dépasse pas 24 caractères";
                        input.removeClass("valid").addClass("invalid");
                        validSubmit[3]=false;
                    } else {
                        input.removeClass("invalid").addClass("valid");
                        validSubmit[3]=true;
                        document.getElementById("ErreurMsg_password_1").innerHTML = "";
                    }
                }
            }
            if (validSubmit[0] == false || validSubmit[1] == false || validSubmit[2] == false || validSubmit[3] == false || validSubmit[4] == false || validSubmit[5] == false){
                document.getElementById("submitBtn").disabled = true;
            } else {
                document.getElementById("submitBtn").disabled = false;
            }
        });
        $('#MotPasse2').on('input', function() {
            var input = $(this);
            var input_2 = $(MotPasse1);
            var pw2 = input.val();
            var pw1 = input_2.val();
            if (pw1 != pw2) {
                document.getElementById("ErreurMsg_password_2").innerHTML = "Les deux Mots de passes ne sont pas identiques";
                input.removeClass("valid").addClass("invalid");
                validSubmit[4]=false;
            } else {
                input.removeClass("invalid").addClass("valid");
                validSubmit[4]=true;
                document.getElementById("ErreurMsg_password_2").innerHTML = "";
            }
            if (validSubmit[0] == false || validSubmit[1] == false || validSubmit[2] == false || validSubmit[3] == false || validSubmit[4] == false || validSubmit[5] == false){
                document.getElementById("submitBtn").disabled = true;
            } else {
                document.getElementById("submitBtn").disabled = false;
            }
        });
        
        // jquery functions to controle entring data when edit a new account
        $('#nomM').on('input', function() {
            var input = $(this);
            var re = /^[A-Za-z]+$/;
            var is_name = input.val();
            if (is_name == "") { 
                document.getElementById("ErreurMsg_nomM").innerHTML = "Vous devez remplis ce champ";
                input.removeClass("valid").addClass("invalid");
                validSubmitM[0]=false;
            } else {
                if (!isNaN(is_name) || !re.test(is_name)) { 
                    document.getElementById("ErreurMsg_nomM").innerHTML = "Le nom doit ne contient que des caracteres";
                    input.removeClass("valid").addClass("invalid");
                    validSubmitM[0]=false;
                } else {
                    input.removeClass("invalid").addClass("valid");
                    validSubmitM[0]=true;
                    document.getElementById("ErreurMsg_nomM").innerHTML = "";
                }
            }
            if (validSubmitM[0] == false || validSubmitM[1] == false || validSubmitM[2] == false || validSubmitM[3] == false || validSubmitM[4] == false || validSubmitM[5] == false){
                document.getElementById("submitBtnM").disabled = true;
            } else {
                document.getElementById("submitBtnM").disabled = false;
            }
        });
        $('#prenomM').on('input', function() {
            var input = $(this);
            var re = /^[A-Za-z]+$/;
            var is_prenom = input.val();
            if (is_prenom == "") {
                document.getElementById("ErreurMsg_prenomM").innerHTML = "Le nom ne doit contient que des caracteres";
                input.removeClass("valid").addClass("invalid");
                validSubmitM[1]=false;
            } else {
                if (!isNaN(is_prenom) || !re.test(is_prenom)) {
                    document.getElementById("ErreurMsg_prenomM").innerHTML = "Le prenom ne doit contient que des caracteres";
                    input.removeClass("valid").addClass("invalid");
                    validSubmitM[1]=false;
                } else {
                    input.removeClass("invalid").addClass("valid");
                    validSubmitM[1]=true;
                    document.getElementById("ErreurMsg_prenomM").innerHTML = "";
                }
            }
            if (validSubmitM[0] == false || validSubmitM[1] == false || validSubmitM[2] == false || validSubmitM[3] == false || validSubmitM[4] == false || validSubmitM[5] == false){
                document.getElementById("submitBtnM").disabled = true;
            } else {
                document.getElementById("submitBtnM").disabled = false;
            }
        });
        $('#numTelM').on('input', function() {
            var input = $(this);
            var is_numTel = input.val();
            var pattern = /^\d+\.?\d*$/;
            if (is_numTel == "") { 
                document.getElementById("ErreurMsg_numTelM").innerHTML = "Vous devez remplis ce champ";
                input.removeClass("valid").addClass("invalid");
                validSubmitM[5]=false;
            } else {
                if (!(pattern.test(is_numTel))) { 
                    document.getElementById("ErreurMsg_numTelM").innerHTML = "Le nom doit ne contient que des caracteres";
                    input.removeClass("valid").addClass("invalid");
                    validSubmitM[5]=false;
                } else {
                    input.removeClass("invalid").addClass("valid");
                    validSubmitM[5]=true;
                    document.getElementById("ErreurMsg_numTelM").innerHTML = "";
                }
            }
            if (validSubmitM[0] == false || validSubmitM[1] == false || validSubmitM[2] == false || validSubmitM[3] == false || validSubmitM[4] == false || validSubmitM[5] == false){
                document.getElementById("submitBtnM").disabled = true;
            } else {
                document.getElementById("submitBtnM").disabled = false;
            }
        });
        $('#emailM').on('input', function() {
            var input = $(this);
            var re = /^[a-zA-Z0-9.!#$%&'*+/=?^_`{|}~-]*$/;
            var is_email = input.val();
            if (is_email == "") {
                document.getElementById("ErreurMsg_emailM").innerHTML = "Vous devez remplis ce champ";
                input.removeClass("valid").addClass("invalid");
                validSubmitM[2]=false;
            } else {
                if (re.test(is_email)) {
                    document.getElementById("ErreurMsg_emailM").innerHTML = "Vous devez respecter le format d'un Email";
                    input.removeClass("valid").addClass("invalid");
                    validSubmitM[2]=false;
                } else {
                    input.removeClass("invalid").addClass("valid");
                    validSubmitM[2]=true;
                    document.getElementById("ErreurMsg_emailM").innerHTML = "";
                }
            }
            if (validSubmitM[0] == false || validSubmitM[1] == false || validSubmitM[2] == false || validSubmitM[3] == false || validSubmitM[4] == false || validSubmitM[5] == false){
                document.getElementById("submitBtnM").disabled = true;
            } else {
                document.getElementById("submitBtnM").disabled = false;
            }
        });
        $('#MotPasse1M').on('input', function() {
            var input = $(this);
            var is_password = input.val();
            if (is_password == "") {
                document.getElementById("ErreurMsg_password_1M").innerHTML = "Veuillez entrer un mot de passe";
                input.removeClass("valid").addClass("invalid");
                validSubmitM[3]=false;
            } else {
                if (is_password.length < 8) {
                    document.getElementById("ErreurMsg_password_1M").innerHTML = "Le mot de passe doit etre plus de 8 caractères";
                    input.removeClass("valid").addClass("invalid");
                    validSubmitM[3]=false;
                } else {
                    if (is_password.length > 24) {
                        document.getElementById("ErreurMsg_password_1M").innerHTML = "Le mot de passe ne dépasse pas 24 caractères";
                        input.removeClass("valid").addClass("invalid");
                        validSubmitM[3]=false;
                    } else {
                        input.removeClass("invalid").addClass("valid");
                        validSubmitM[3]=true;
                        document.getElementById("ErreurMsg_password_1M").innerHTML = "";
                    }
                }
            }
            var input_2 = $(MotPasse2M);
            if (input_2.val() != is_password) {
                validSubmitM[5] = false;
            } else {
                validSubmitM[5] = true;
            }
            if (validSubmitM[0] == false || validSubmitM[1] == false || validSubmitM[2] == false || validSubmitM[3] == false || validSubmitM[4] == false || validSubmitM[5] == false){
                document.getElementById("submitBtnM").disabled = true;
            } else {
                document.getElementById("submitBtnM").disabled = false;
            }
        });
        $('#MotPasse2M').on('input', function() {
            var input = $(this);
            var input_2 = $(MotPasse1M);
            var pw2 = input.val();
            var pw1 = input_2.val();
            if (pw1 != pw2) {
                document.getElementById("ErreurMsg_password_2M").innerHTML = "Les deux Mots de passes ne sont pas identiques";
                input.removeClass("valid").addClass("invalid");
                validSubmitM[4]=false;
            } else {
                input.removeClass("invalid").addClass("valid");
                validSubmitM[4]=true;
                document.getElementById("ErreurMsg_password_2M").innerHTML = "";
            }
            if (validSubmitM[0] == false || validSubmitM[1] == false || validSubmitM[2] == false || validSubmitM[3] == false || validSubmitM[4] == false || validSubmitM[5] == false){
            document.getElementById("submitBtnM").disabled = true;
            } else {
                document.getElementById("submitBtnM").disabled = false;
            }
        });
    });
</script>
<script>
    // function that controle to show how many row of selected table
    $(document).ready(function() {
        $('#tableID').DataTable({     
        "aLengthMenu": [[5, 10, 25, -1], [5, 10, 25, "All"]],
        "iDisplayLength": 5});
    });

    // function that check all checkboxes inputs
    function checkAll(bx) {
        var cbs = document.getElementsByTagName('input');
        for(var i=0; i < cbs.length; i++) {
            if(cbs[i].type == 'checkbox') {
            cbs[i].checked = bx.checked;
            };
        };
        checkCHKBOX();
        checkCHKBOXedit();
    };

    // function that fill value of hidden input in orther to pass arguments to backend (for delete module)
    function getSelectesAccounts(){
        var cbs = document.getElementsByTagName('input');
        document.getElementById('hiddenQR').value = "";
        for(var i=0; i < cbs.length; i++) {
            if(cbs[i].type === 'checkbox' && cbs[i].checked === true ) {
                document.getElementById('hiddenQR').value += cbs[i].name+" ";
            }
        }
    }

    // function that fill value of hidden input in orther to pass arguments to backend (for edit module)
    function getSelectesAccountsForEdit(){
        var cbs = document.getElementsByTagName('input');
        for(var i=0; i < cbs.length; i++) {
            if(cbs[i].type === 'checkbox' && cbs[i].checked === true ) {
                document.getElementById('hiddenQRM').value = cbs[i].name;
                break;
            }
        }
    }

    // function that enable click on delete button
    function checkCHKBOX(){
        var cbs = document.getElementsByTagName('input');
        let suppossible = false;
        for(var i=0; i < cbs.length; i++) {
            if(cbs[i].type == 'checkbox' && cbs[i].checked === true && cbs[i].name != 'firstcheckbox') {
                suppossible = true;
                break;
            }
        }
        if (suppossible == true){
            document.getElementById('btnsup').disabled = false;
        } else {
            document.getElementById('btnsup').disabled = true;
        }
    }

    // this allow to attribute the time and the date of creation of the account
    var d = new Date();
    document.getElementById('dateCreationhidden').value=  d.getDate()  + "-" + (d.getMonth()+1) + "-" + d.getFullYear() + " " +d.getHours() + ":" + d.getMinutes();

    // function that enable click on edit button
    function checkCHKBOXedit(){
        var cbs = document.getElementsByTagName('input');
        let compteur = 0;
        for(var i=0; i < cbs.length; i++) {
            if(cbs[i].type == 'checkbox' && cbs[i].checked === true && cbs[i].name != 'firstcheckbox') {
                compteur=compteur+1;
            }
        }
        if (compteur == 1){
            document.getElementById('btnedit').disabled = false;
        } else {
            document.getElementById('btnedit').disabled = true;
        }
    }

    // display the selected row table in FORM number 3 (edit form)
    function fetchRowToEditForm() {
        var table = document.getElementById("tableID");
        var rows = table.getElementsByTagName("tr");
        for (let i = 1; i < rows.length; i++) {
            // console.log(document.getElementById('hiddenQRM').value);
            // console.log(table.rows[1].getElementsByTagName("td")[0].getElementsByTagName("input")[0].name);
            if (table.rows[i].getElementsByTagName("td")[0].getElementsByTagName("input")[0].name == document.getElementById('hiddenQRM').value){
                document.getElementById('nomM').value = table.rows[i].getElementsByTagName("td")[2].innerHTML;
                document.getElementById('prenomM').value = table.rows[i].getElementsByTagName("td")[3].innerHTML;
                document.getElementById('numTelM').value = table.rows[i].getElementsByTagName("td")[4].innerHTML;
                document.getElementById('emailM').value = table.rows[i].getElementsByTagName("td")[5].innerHTML;
                document.getElementById('MotPasse1M').value = table.rows[i].getElementsByTagName("td")[7].innerHTML;
                document.getElementById('MotPasse2M').value = table.rows[i].getElementsByTagName("td")[7].innerHTML;
                break;
            }
        }
    }
</script>
<!-- data dir -->
<script id="dirsdata" type="application/json">
    [
        <% data1.forEach(entry => { %>
        {"nomDirection":"<%= entry.nomDirection%>",
        "nomSousDirection":"<%= entry.nomSousDirection%>",
        "IDdirection":"<%= entry.IDdirection %>"},
    <% }) %>
{}]
</script>
<!-- data dep -->
<script id="depsdata" type="application/json">
    [
        <% data2.forEach(entry => { %>
        {"nomDepartement":"<%= entry.nomDepartement%>",
        "nomEquipe":"<%= entry.nomEquipe%>",
        "IDdepartement":"<%= entry.IDdepartement %>"},
    <% }) %>
{}]
</script>
<script src="https://cdn.datatables.net/1.10.16/js/jquery.dataTables.min.js"></script>
<script src="https://cdn.datatables.net/1.10.16/js/dataTables.bootstrap4.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/popper.js@1.14.3/dist/umd/popper.min.js" integrity="sha384-ZMP7rVo3mIykV+2+9J3UJ46jBk0WLaUAdn689aCwoqbBJiSnjAK/l8WvCWPIPm49" crossorigin="anonymous"></script>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@4.1.3/dist/js/bootstrap.min.js" integrity="sha384-ChfqqxuZUCnJSK3+MXmPNIyE6ZbWh2IMqE241rYiqJxyMiZ6OW/JmZQ5stwEULTy" crossorigin="anonymous"></script>    
</html>