<!doctype html>
<html>
<head>
    <title>Admin - Entreprise</title>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.1.3/dist/css/bootstrap.min.css" integrity="sha384-MCw98/SFnGE8fJT3GXwEOngsV7Zt27NXFoaoApmYm81iuXoPkFOJwJ8ERdknLPMO" crossorigin="anonymous">
    <script src="https://code.jquery.com/jquery-1.11.1.min.js"></script>
</head>
<body>
    <nav class="navbar navbar-expand-lg navbar-light bg-success sticky-top">
        <button class="navbar-toggler bg-light" type="button" data-toggle="collapse" data-target="#navbarNavAltMarkup" aria-controls="navbarNavAltMarkup" aria-expanded="false" aria-label="Toggle navigation">
            <span class="navbar-toggler-icon"></span>
        </button>
        <div class="collapse navbar-collapse" id="navbarNavAltMarkup">
            <div class="navbar-nav">
                <a class="nav-item nav-link text-light active" href="adminaccueil">Accueil<span class="sr-only">(current)</span></a>
                <a class="nav-item nav-link text-light" href="#section1">Gestion des Directions et Sous Directions</a>
                <a class="nav-item nav-link text-light" href="#section2">Gestion des Départements et Equipes</a>
            </div>
        </div>
        <button class="btn btn-outline-light my-2 my-sm-0"><a class="text-light" href="/">Déconnecter</a></button>
    </nav>
    <div class="container">
        <div class="py-3"></div>
        <div class="row" id="section1">
            <div class="breadcrumb breadcrumb-item active">
                Gestion des Directions et Sous Directions
            </div>
        </div>
        <div class="row">
            <div class="col d-flex justify-content-center">
                <button type="button" class="btn btn-success mb-3" style="max-width: 25rem; width: 25rem;" data-toggle="modal" data-target="#exampleModalCenter">
                    Ajouter une Direction
                </button>
            </div>
            <div class="col d-flex justify-content-center">
                <a title="Remarquer" data-toggle="popover" data-trigger="hover" data-content="Vous ne peuvez pas supprimer des Directions si et seulement si tout les départements et les personnes inclus sont aussi supprimées">
                    <button type="button" id="btnsup_1" class="btn btn-danger mb-3" style="max-width: 25rem; width: 25rem;" data-toggle="modal" data-target="#exampleModalCenter2" onclick="getSelectesAccounts_1();" disabled>
                        Supprimer les Directions séléctionnées
                    </button>
                </a>
            </div>
        </div>
        <div class="py-3"></div>
        <div class="row" style="overflow-x:auto;">
            <table id="tableID_1" class="table table-striped table-bordered table-hover" style="width: 100%;">
                <thead>
                    <tr>
                        <th><input type="checkbox" onclick="checkAll_1(this)"></th>
                        <th>#</th>
                        <th>Direction</th>
                        <th>Sous Direction</th>
                        <th>Directeur</th>
                        <th>Sous Directeur</th>
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <% let index_1 = 0; %>
                        <% data1.forEach(entry => { %>
                        <% index_1++; %>
                        <td><input type="checkbox" name="tab1" id="<%= entry.IDdirection %>" onclick="checkCHKBOX_1();"></td>
                        <td><%=  index_1 %></td>
                        <td><%= entry.nomDirection %></td>
                        <td><%= entry.nomSousDirection %></td>
                        <td><%= entry.nomDirecteur %> <%= entry.prenomDirecteur %></td>
                        <td><%= entry.nomSousDirecteur %> <%= entry.prenomSousDirecteur %></td>
                    </tr>
                    <% }) %>
                </tbody>
            </table>
        </div>
        <div class="py-3"></div>
        <!--  -->
        <div class="row" id="section2">
            <div class="breadcrumb breadcrumb-item active">
                Gestion des Départements et Equipes
            </div>
        </div>
        <div class="row">
            <div class="col d-flex justify-content-center">
                <button type="button" class="btn btn-success mb-3" style="max-width: 25rem; width: 25rem;" data-toggle="modal" data-target="#exampleModalCenter3">
                    Ajouter un Département
                </button>
            </div>
            <div class="col d-flex justify-content-center">
                <a title="Remarquer" data-toggle="popover" data-trigger="hover" data-content="Vous ne peuvez pas supprimer des Départements si et seulement si tout les personnes inclus sont tous supprimées">
                    <button type="button" id="btnsup_2" class="btn btn-danger mb-3" style="max-width: 25rem; width: 25rem;" data-toggle="modal" data-target="#exampleModalCenter4" onclick="getSelectesAccounts_2();" disabled>
                        Supprimer les Départements séléctionnées
                    </button>
                </a>
            </div>
        </div>
        <div class="row" style="overflow-x:auto;">
            <table id="tableID_2" class="table table-striped table-bordered table-hover" style="width: 100%;">
                <thead>
                    <tr>
                        <th><input type="checkbox" onclick="checkAll_2(this)"></th>
                        <th>#</th>
                        <th>Direction</th>
                        <th>Département</th>
                        <th>Equipe</th>
                        <th>Capacité de l'Equipe</th>
                        <th>Chef Département</th>
                        <th>Chef Equipe</th>
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <% let index_2 = 0; %>
                        <% data2.forEach(entry => { %>
                        <% index_2++; %>
                        <td><input type="checkbox" name="tab2" id="<%= entry.IDdepartement %>" onclick="checkCHKBOX_2();"></td>
                        <td><%= index_2 %></td>
                        <td><%= entry.nomDirection %></td>
                        <td><%= entry.nomDepartement %></td>
                        <td><%= entry.IDequipe %></td>
                        <td><%= entry.capaciteEquipe %></td>
                        <td><%= entry.nomChefDep %> <%= entry.prenomChefDep %></td>
                        <td><%= entry.nomChefEqu %> <%= entry.prenomChefEqu %></td>
                    </tr>
                    <% }) %>
                </tbody>
            </table>
        </div>
    </div>
    <div class="py-3"></div>
    <div class="py-3"></div>
    <!-- Form 1: creer dir -->
    <div class="modal fade" id="exampleModalCenter" tabindex="-1" role="dialog" aria-labelledby="exampleModalCenterTitle" aria-hidden="true">
        <div class="modal-dialog modal-dialog-centered" role="document">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">Ajouter une Direction</h5>
                    <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                        <span aria-hidden="true">&times;</span>
                    </button>
                </div>
                <div class="modal-body">
                    <!-- here i put the form code -->
                    <form action="/ajouterDir" method="POST">
                        <div class="form-group d-flex">
                            <label class="col-sm-5 col-form-label">Nom Direction</label>
                            <input type="text" class="form-control rounded-left" name="nomDir" required>
                        </div>
                        <div class="form-group d-flex">
                            <label class="col-sm-5 col-form-label">Nom Sous Direction</label>
                            <input type="text" class="form-control rounded-left" name="nomSDir" required>
                        </div>
                        <div class="form-group"></div>
                        <button type="submit" class="form-control btn btn-success rounded submit px-3">Ajouter</button>
                    </form>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-dismiss="modal">Annuler</button>
                </div>
            </div>
        </div>
    </div>
    <!-- Form 2: valider la supprission / supprimer dir -->
    <div class="modal fade" id="exampleModalCenter2" tabindex="-1" role="dialog" aria-labelledby="exampleModalCenterTitle" aria-hidden="true">
        <div class="modal-dialog modal-dialog-centered" role="document">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">Supprimer les Directions séléctionnées</h5>
                    <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                        <span aria-hidden="true">&times;</span>
                    </button>
                </div>
                <div class="modal-body">
                    <!-- here i put the form code -->
                    <form action="/supprimerDir" method="POST">
                        <h6 class="text-danger">Cette action n'est pas récéproque</h6>
                        <h6 class="text-danger">Vous ne peuvez pas supprimer des Directions si et seulement si tout les départements et les personnes inclus sont aussi supprimées</h6>
                        <input type="hidden" id="hiddenQR_1" name="hiddenQR_1" value="">
                        <button type="submit" class="form-control btn btn-danger rounded submit px-3">Supprimer</button>
                    </form>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-dismiss="modal">Annuler</button>
                </div>
            </div>
        </div>
    </div>
    <!-- Form 3: creer dep -->
    <div class="modal fade" id="exampleModalCenter3" tabindex="-1" role="dialog" aria-labelledby="exampleModalCenterTitle" aria-hidden="true">
        <div class="modal-dialog modal-dialog-centered" role="document">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">Ajouter un Département</h5>
                    <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                        <span aria-hidden="true">&times;</span>
                    </button>
                </div>
                <div class="modal-body">
                    <!-- here i put the form code -->
                    <form action="/ajouterDep" method="POST">
                        <div class="form-group d-flex">
                            <label class="col-sm-4 col-form-label">Direction</label>
                            <select class="custom-select my-1 mr-sm-2" id="selectedD" name="selectedD">
                                <% data1.forEach(entry => { %>
                                <option value="<%= entry.IDdirection %>"><%= entry.nomDirection %></option>
                                <% }) %>
                            </select>
                        </div>
                        <div class="form-group">
                            <input type="text" class="form-control rounded-left" placeholder="Nom Département" name="nomDep" required>
                        </div>
                        <div class="form-group d-flex">
                            <label class="col-sm-4 col-form-label">ID Equipe</label>
                            <input type="text" class="form-control rounded-left" placeholder="ID Equipe" name="idE" id="idE" required>
                        </div>
                        <div class="form-group d-flex">
                            <label class="col-sm-6 col-form-label">Capacité de l'Equipe</label>
                            <input type="number" class="form-control rounded-left" placeholder="Capacité" name="capE" required>
                        </div>
                        <div class="form-group"></div>
                        <button type="submit" class="form-control btn btn-success rounded submit px-3">Ajouter</button>
                    </form>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-dismiss="modal">Annuler</button>
                </div>
            </div>
        </div>
    </div>
    <!-- Form 4: valider la supprission / supprimer dep -->
    <div class="modal fade" id="exampleModalCenter4" tabindex="-1" role="dialog" aria-labelledby="exampleModalCenterTitle" aria-hidden="true">
        <div class="modal-dialog modal-dialog-centered" role="document">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">Supprimer les Départements séléctionnées</h5>
                    <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                        <span aria-hidden="true">&times;</span>
                    </button>
                </div>
                <div class="modal-body">
                    <!-- here i put the form code -->
                    <form action="/supprimerDep" method="POST">
                        <h6 class="text-danger">Cette action n'est pas récéproque</h6>
                        <h6 class="text-danger">Vous ne peuvez pas supprimer des Départements si et seulement si tout les personnes inclus sont tous supprimées</h6>
                        <input type="hidden" id="hiddenQR_2" name="hiddenQR_2" value="">
                        <button type="submit" class="form-control btn btn-danger rounded submit px-3">Supprimer</button>
                    </form>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-dismiss="modal">Annuler</button>
                </div>
            </div>
        </div>
    </div>
</body>
<footer class="fixed-bottom">
    <div class="bg-success">
        <div class="footer-copyright text-center py-2 text-light">
            © <script>document.write(new Date().getFullYear())</script> Copyright | Direction des resources Humaine - DRH
        </div>
    </div>
</footer>
<script>
    // function that controle to show how many row of selected table
    $(document).ready(function() {
        $('#tableID_1').DataTable({     
        "aLengthMenu": [[5, 10, 25, -1], [5, 10, 25, "All"]],
        "iDisplayLength": 5});
        $('#tableID_2').DataTable({     
        "aLengthMenu": [[5, 10, 25, -1], [5, 10, 25, "All"]],
        "iDisplayLength": 5});
        $('[data-toggle="popover"]').popover();
    });

    // function that check all checkboxes inputs
    function checkAll_1(bx) {
        var cbs = document.getElementsByTagName('input');
        for(var i=0; i < cbs.length; i++) {
            if(cbs[i].type == 'checkbox' && cbs[i].name == 'tab1') {
            cbs[i].checked = bx.checked;
            };
        };
        checkCHKBOX_1();
    };
    function checkAll_2(bx) {
        var cbs = document.getElementsByTagName('input');
        for(var i=0; i < cbs.length; i++) {
            if(cbs[i].type == 'checkbox' && cbs[i].name == 'tab2') {
            cbs[i].checked = bx.checked;
            };
        };
        checkCHKBOX_2();
    };

    // function that fill value of hidden input in orther to pass arguments to backend
    function getSelectesAccounts_1(){
        var cbs = document.getElementsByTagName('input');
        document.getElementById('hiddenQR_1').value = "";
        for(var i=0; i < cbs.length; i++) {
            if(cbs[i].type === 'checkbox' && cbs[i].checked === true && cbs[i].name == 'tab1') {
                document.getElementById('hiddenQR_1').value += cbs[i].id+" ";
            }
        }
    }
    function getSelectesAccounts_2(){
        var cbs = document.getElementsByTagName('input');
        document.getElementById('hiddenQR_2').value = "";
        for(var i=0; i < cbs.length; i++) {
            if(cbs[i].type === 'checkbox' && cbs[i].checked === true && cbs[i].name == 'tab2') {
                document.getElementById('hiddenQR_2').value += cbs[i].id+" ";
            }
        }
    }

    // function that enable click on delete button
    function checkCHKBOX_1(){
        var cbs = document.getElementsByTagName('input');
        let suppossible = false;
        for(var i=0; i < cbs.length; i++) {
            if(cbs[i].type == 'checkbox' && cbs[i].checked === true && cbs[i].name == 'tab1') {
                suppossible = true;
                break;
            }
        }
        if (suppossible == true){
            document.getElementById('btnsup_1').disabled = false;
        } else {
            document.getElementById('btnsup_1').disabled = true;
        }
    }
    function checkCHKBOX_2(){
        var cbs = document.getElementsByTagName('input');
        let suppossible = false;
        for(var i=0; i < cbs.length; i++) {
            if(cbs[i].type == 'checkbox' && cbs[i].checked === true && cbs[i].name == 'tab2') {
                suppossible = true;
                break;
            }
        }
        if (suppossible == true){
            document.getElementById('btnsup_2').disabled = false;
        } else {
            document.getElementById('btnsup_2').disabled = true;
        }
    }

    // this upropose an id/name for a team
    document.getElementById("idE").value = "equipe" + Math.floor(Math.random()*100 + 1)+Math.floor(Math.random()*100 + 1);
</script>
<script src="https://cdn.datatables.net/1.10.16/js/jquery.dataTables.min.js"></script>
<script src="https://cdn.datatables.net/1.10.16/js/dataTables.bootstrap4.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/popper.js@1.14.3/dist/umd/popper.min.js" integrity="sha384-ZMP7rVo3mIykV+2+9J3UJ46jBk0WLaUAdn689aCwoqbBJiSnjAK/l8WvCWPIPm49" crossorigin="anonymous"></script>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@4.1.3/dist/js/bootstrap.min.js" integrity="sha384-ChfqqxuZUCnJSK3+MXmPNIyE6ZbWh2IMqE241rYiqJxyMiZ6OW/JmZQ5stwEULTy" crossorigin="anonymous"></script>    
</html>